# yaml-language-server: $schema=./schemas/bundle_config_schema.json


bundle:
  name: retail-ai-bundle

artifacts:
  default:
    type: whl
    build: uv build
    path: .


resources:
  jobs:
    deploy-retail-ai-job:
      name: deploy-retail-ai-job
      job_clusters:
        - job_cluster_key: common-cluster
          new_cluster:
            spark_version: "latest"
            node_type_id: "i3.xlarge"
            num_workers: 1
      tasks:
        - task_key: intest-and-transform
          job_cluster_key: common-cluster
          notebook_task:
            notebook_path: ./notebooks/01_ingest_and_transform.py
          libraries:
            - whl: ./dist/*.whl
        - task_key: provision-vector-search
          depends_on:
            - task_key: intest-and-transform
          job_cluster_key: common-cluster
          notebook_task:
            notebook_path: ./notebooks/02_provision_vector_search.py
          libraries:
            - whl: ./dist/*.whl
        - task_key: generate-evaluation-data
          depends_on:
            - task_key: provision-vector-search
          job_cluster_key: common-cluster
          notebook_task:
            notebook_path: ./notebooks/03_generate_evaluation_data.py
          libraries:
            - whl: ./dist/*.whl
        - task_key: unity-catalog-tools
          depends_on:
            - task_key: provision-vector-search
          job_cluster_key: common-cluster
          notebook_task:
            notebook_path: ./notebooks/04_unity_catalog_tools.py
          libraries:
            - whl: ./dist/*.whl
        - task_key: deploy-agents
          depends_on:
            - task_key: unity-catalog-tools
          job_cluster_key: common-cluster
          notebook_task:
            notebook_path: ./notebooks/05_agent_as_code_driver.py
          libraries:
            - whl: ./dist/*.whl

targets:
  dev:
    default: True
    workspace:
      host: <workspace-url>
