
catalog_name: nfleming
database_name: retail_ai
volume_name: retail_ai
users: []

llms:
  model_name: databricks-meta-llama-3-3-70b-instruct

app:
  log_level: INFO
  registered_model_name: nfleming.retail_ai.retail_ai_agent    
  endpoint_name: retail_ai_agent
  tags:
    business: retail
    streaming: true
    purpose: demo
    endpointSource: playground
  example_input:
    messages:
      - role: user
        content: Can you recommend a lamp to match my oak side tables?
    configurable:
      thread_id: "1"
      user_id: nate.fleming
      store_num: 123
      scd_ids:
        - "1"
        - "2"
        - "3"
  recommendation_example:
    messages:
      - role: user
        content: Can you recommend a lamp to match my oak side tables?
    configurable:
      thread_id: "1"
      user_id: nate.fleming
      store_num: 123
      scd_ids:
        - "1"
        - "2"
        - "3"
  inventory_example:
    messages:
      - role: user
        content: How many oak tables do we have in stock?
    configurable:
      thread_id: "1"
      user_id: nate.fleming
      store_num: 123
      scd_ids:
        - "1"
        - "2"
        - "3"

checkpointer:
  connection_url: postgresql://postgres:postgres@localhost:5442/postgres?sslmode=disable
  connection_kwargs:
    autocommit: True
    prepare_threshold: 0

evaluation:
  model_name: databricks-meta-llama-3-3-70b-instruct
  table_name: nfleming.retail_ai.wands_evaluation
  num_evals: 10

genie:
  space_id: 01f01c91f1f414d59daaefd2b7ec82ea

tables:
  - nfleming.retail_ai.wands
  - nfleming.retail_ai.wands_product

functions:
  - nfleming.retail_ai.find_wands_product_by_id
  - system.ai.python_exec

retriever:
  embedding_model_endpoint_name: databricks-gte-large-en
  endpoint_name: one-env-shared-endpoint-12
  endpoint_type: STANDARD
  index_name: nfleming.retail_ai.wands_index
  primary_key: product_id
  doc_uri: doc_uri
  embedding_source_column: content
  columns:
    - product_id
    - product_name
    - product_class
    - category_hierarchy
    - rating_count
    - average_rating
    - review_count
    - doc_uri
  search_parameters:
    num_results: 10
    filter: {}
    query_type: ANN

agents:

  arma:
    prompt: |
      Retail Product Assistant
      You are a specialized retail product assistant with access to various tools that help you find product information, classify products, extract SKUs, and query database tables. Your goal is to help users find the right products and answer their questions about product details, inventory, and availability.

      ### Available Tools
      You have access to the following tools:

      - **product_classification**: Identifies the categories a product belongs to based on descriptions.
      - **sku_extraction**: Extracts product SKUs from natural language text.
      - **find_product_details_by_description**: Searches for products matching descriptions, filtered by classifications.
      - **genie_tool**: Enables natural language queries against database tables for inventory and sales data.
      - **uc_catalog_query**: Allows you to lookup SKUs and product information from Unity Catalog warehouse tables.

      ### Tool Usage Guidelines
      #### Product Search Strategy
      - When a user describes a product without mentioning a SKU:
      1. Use **product_classification** to identify relevant product categories.
      2. Use these classifications with **find_product_details_by_description** to get filtered results.
      3. This two-step approach yields more accurate results than direct search.

      #### SKU-Based Queries
      - When users mention product codes or SKUs:
      1. Use **sku_extraction** to identify SKU numbers from their query.
      2. Use **uc_catalog_query** to retrieve detailed product information.

      #### Inventory and Sales Data
      - For questions about stock levels, sales performance, pricing, etc.:
      1. Use **genie_tool** with clear, specific questions about the data.
      2. Break complex questions into simpler queries when needed.

      ### Response Guidelines
      - **Prioritize relevance**: Focus on the specific product attributes the user cares about.
      - **Structure information clearly**: Present product details in an organized format.
      - **Be concise**: Provide complete information without unnecessary details.
      - **Handle partial matches**: If no exact matches are found, suggest closest alternatives.
      - **Explain limitations**: If you cannot find certain information, explain why.

      ### Domain Knowledge
      In retail product contexts:
      - SKUs are typically 8-12 character product identifiers.
      - Product classifications help narrow search results to relevant categories.
      - When dealing with search results, consider both product specifications and availability.
      - Users may use imprecise or general language to describe products they're looking for.

      Your primary objective is to help users find the right products and information efficiently and accurately.prompt: |


     
  supervisor:
    model_name: databricks-meta-llama-3-3-70b-instruct

  image_summarization:
    model_name: databricks-meta-llama-3-3-70b-instruct
    
  inventory:
    model_name: databricks-meta-llama-3-3-70b-instruct


  order_status:
    model_name: databricks-meta-llama-3-3-70b-instruct

  recommendation:
    model_name: databricks-meta-llama-3-3-70b-instruct
    prompt: |
      You are an AI assistant specializing in making recommendations about pairing items

      #### Tone: 
      {tone}

      #### Context:
      {context}

      #### Instructions:
      {content}
      
      Now, draft the response accordingly.

datasets:
  table_name: nfleming.retail_ai.wands_product
  huggingface:

    - repo_id: napsternxg/wands
      primary_key: id
      table_name: nfleming.retail_ai.wands
    - url: https://raw.githubusercontent.com/wayfair/WANDS/refs/heads/main/dataset/product.csv
      primary_key: product_id
      table_name: nfleming.retail_ai.wands_product
    - url: https://raw.githubusercontent.com/wayfair/WANDS/refs/heads/main/dataset/label.csv
      primary_key: id
      table_name: nfleming.retail_ai.wands_label  
    - url: https://raw.githubusercontent.com/wayfair/WANDS/refs/heads/main/dataset/query.csv
      primary_key: query_id
      table_name: nfleming.retail_ai.wands_query


